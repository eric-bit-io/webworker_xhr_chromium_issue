<html>
    <head>
        <script>
            // stream test
            const supportsRequestStreams = (() => {
                let duplexAccessed = false;

                const hasContentType = new Request('', {
                    body: new ReadableStream(),
                    method: 'POST',
                    get duplex() {
                        duplexAccessed = true;
                        return 'half';
                    },
                }).headers.has('Content-Type');

                return duplexAccessed && !hasContentType;
            })();
            console.log("stream support", supportsRequestStreams)
            // worker
            let worker = new SharedWorker("worker.js");

            worker.port.addEventListener("message", function (e) {
                console.log("from worker:", e.data);
            }, false);

            worker.port.start();

            // post a message to the shared web worker
            // worker.port.postMessage("Alyssa");
            window.onload = () => {
                const input = document.querySelector("#file-input")
                input.addEventListener("change", () => {
                    const firstFile = input.files[0];
                    console.log(input.files)
                    console.log("sending file...")
                    // const dateString = new Date().getTime().toString()
                    // var firstFile = new File([dateString], dateString, {type: "text/plain", lastModified: new Date().getTime()})
                    worker.port.postMessage({file: firstFile})
                })
            }
        </script>
    </head>
    <body>
        <div>
            <input id="file-input" type="file"/>
        </div>
    </body>
</html>